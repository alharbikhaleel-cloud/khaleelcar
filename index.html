<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>khaleelcar â€” Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
  <meta name="description" content="Ù…Ù†ØµØ© khaleelcar Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø¨ÙŠØ¹ Ø¨Ù…ÙˆØ§ØµÙØ§Øª ÙƒØ§Ù…Ù„Ø© Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ¯Ø§Ø®Ù„ÙŠØ©." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --purple:#e9ddff; --purple-600:#7c3aed;
      --gold:#c5a100; --gold-700:#9c7f00;
      --text:#1f2937; --muted:#6b7280; --bg:#f9fafb;
      --card:#ffffff; --shadow:0 10px 24px rgba(124,58,237,.10);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:"Tajawal",system-ui; color:var(--text); background:linear-gradient(180deg, var(--purple) 0%, #fff 16%, var(--bg) 100%)}

    /* Ø£Ù…Ø§ÙƒÙ† Ø­Ù‚Ù† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ */
    #header-placeholder, #footer-placeholder {display:block}

    .container{max-width:1200px;margin:0 auto;padding:16px}
    .hero{
      background: radial-gradient(circle at 20% 10%, var(--purple) 0%, #fff 40%);
      border:1px solid rgba(124,58,237,.1); border-radius:24px; padding:26px; margin:16px;
      box-shadow: var(--shadow);
    }
    .hero h1{margin:0 0 8px;font-size:1.8rem}
    .hero p{margin:0;color:var(--muted)}

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;padding:16px}
    @media (max-width:1000px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:640px){ .grid{grid-template-columns:1fr} }

    .card{
      background:var(--card); border:1px solid rgba(0,0,0,.06); border-radius:18px; overflow:hidden;
      box-shadow: var(--shadow); display:flex; flex-direction:column
    }
    .thumb{aspect-ratio:16/9; object-fit:cover; width:100%; background:#f3f4f6}
    .body{padding:14px}
    .title{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:6px}
    .title h3{margin:0;font-size:1.1rem}
    .price{color:var(--gold);font-weight:700}
    .chips{display:flex;flex-wrap:wrap; gap:6px; margin:8px 0}
    .chip{font-size:.8rem;background:var(--purple);padding:6px 10px;border-radius:999px;border:1px solid rgba(124,58,237,.2)}
    .actions{display:flex;gap:8px;margin-top:10px}
    .btn{
      flex:1; text-align:center; padding:10px 12px; border-radius:12px; cursor:pointer;
      border:1px solid rgba(0,0,0,.08); background:#fff; font-weight:700; transition:.2s
    }
    .btn.primary{background:linear-gradient(180deg, var(--gold), var(--gold-700)); color:#fff; border:none}
    .btn:hover{transform:translateY(-1px)}

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ù…ÙˆØ¯Ø§Ù„) */
    dialog{
      border:none; border-radius:16px; box-shadow:0 30px 80px rgba(0,0,0,.28); width:min(720px,92%);
      padding:0; overflow:hidden
    }
    dialog::backdrop{background:rgba(0,0,0,.45)}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid rgba(0,0,0,.06);background:#fff}
    .modal-body{padding:16px;background:#fff}
    .specs{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .specs section{border:1px solid rgba(0,0,0,.06);border-radius:12px;padding:12px;background:#fafafa}
    .specs h4{margin:0 0 8px;font-size:1rem;color:#111827}
    .specs ul{margin:0;padding-inline-start:18px}
    .close{background:#fff;border:1px solid rgba(0,0,0,.1);border-radius:10px;padding:8px 12px;cursor:pointer}

    /* Ø´Ø±ÙŠØ· ÙÙ„ØªØ±Ø© Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ø§Ù„ØµÙØ­Ø© (ÙŠØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¨Ø­Ø« Ø§Ù„Ù‡ÙŠØ¯Ø±) */
    .filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 16px}
    .filters input, .filters select{
      padding:8px 10px;border-radius:10px;border:1px solid rgba(0,0,0,.12);background:#fff;min-width:140px
    }
    .filters .badge{padding:6px 10px;border-radius:999px;background:#fff;border:1px dashed var(--gold);color:var(--gold-700);font-size:.85rem}
    .sr{position:absolute; left:-10000px; width:1px; height:1px; overflow:hidden;}
    /* Ø±Ø³Ø§Ø¦Ù„ */
    .notice{margin:10px 16px;font-size:.95rem;color:#059669;display:none}
    .error{margin:10px 16px;font-size:.95rem;color:#dc2626;display:none}
  </style>
</head>
<body>

<!-- placeholders -->
<div id="header-placeholder"></div>

<main class="container">
  <section class="hero" aria-labelledby="heroTitle">
    <h1 id="heroTitle">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ <span style="color:var(--gold);font-weight:700">khaleelcar</span></h1>
    <p>Ø§Ø³ØªÙƒØ´Ù Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø®ØªØ§Ø±Ø© Ø¨Ù…ÙˆØ§ØµÙØ§ØªÙ‡Ø§ <strong>Ø§Ù„Ø¹Ø§Ù…Ø©</strong> Ùˆ<strong>Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</strong> Ùˆ<strong>Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</strong> â€” Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù†Ø§Ù‚Ø©.</p>
  </section>

  <section class="filters" aria-label="Ù…Ø±Ø´Ø­Ø§Øª">
    <label class="sr" for="brand">Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</label>
    <select id="brand">
      <option value="">ÙƒÙ„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª</option>
      <option>ØªÙˆÙŠÙˆØªØ§</option>
      <option>Ù…Ø±Ø³ÙŠØ¯Ø³</option>
      <option>Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ</option>
    </select>

    <label class="sr" for="fuel">Ø§Ù„ÙˆÙ‚ÙˆØ¯</label>
    <select id="fuel">
      <option value="">ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯</option>
      <option>Ø¨Ù†Ø²ÙŠÙ†</option>
      <option>Ø¯ÙŠØ²Ù„</option>
      <option>Ù‡Ø§ÙŠØ¨Ø±Ø¯</option>
      <option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
    </select>

    <input id="minPrice" type="number" inputmode="numeric" placeholder="Ø£Ø¯Ù†Ù‰ Ø³Ø¹Ø± (Ø±.Ø³)" />
    <input id="maxPrice" type="number" inputmode="numeric" placeholder="Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± (Ø±.Ø³)" />
    <span class="badge">Ø£Ù„ÙˆØ§Ù†: Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ ÙØ§ØªØ­ âœ¨ + Ø°Ù‡Ø¨ÙŠ</span>
  </section>

  <div id="ok" class="notice" role="status" aria-live="polite"></div>
  <div id="err" class="error" role="alert" aria-live="assertive"></div>

  <section id="cars" class="grid" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª"></section>
</main>

<div id="footer-placeholder"></div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
<dialog id="detailsDialog" aria-label="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
  <div class="modal-head">
    <strong id="modalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</strong>
    <button class="close" type="button" id="closeModal">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
  <div class="modal-body">
    <img id="modalImg" class="thumb" alt="ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©" />
    <div class="specs" style="margin-top:12px">
      <section>
        <h4>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
        <ul id="genSpecs"></ul>
      </section>
      <section>
        <h4>Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</h4>
        <ul id="extSpecs"></ul>
      </section>
      <section>
        <h4>Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h4>
        <ul id="intSpecs"></ul>
      </section>
    </div>
  </div>
</dialog>

<script>
/** =========================================================
 * Ø£Ù…Ø§Ù† ÙˆØ£Ø¯Ø§Ø¡ ÙˆØµÙŠØ§Ù†Ø©:
 * - ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø¹Ø¨Ø± fetch Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… HTTPS Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ… (Ù…Ù„ÙØ§Øª Ù…Ø­Ù„ÙŠØ© ØªØ¹Ù…Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©).
 * - ØªÙ†Ø¸ÙŠÙ Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù…Ù†Ø¹ XSS.
 * - Ø¥Ø¯Ø§Ø±Ø© Ø£Ø®Ø·Ø§Ø¡ fetch Ù…Ø¹ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….
 * - ÙØµÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù† Ø§Ù„Ø¹Ø±Ø¶ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©.
 * - Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ®Ø²ÙŠÙ† Ø­Ø³Ø§Ø³ Ø£Ùˆ ØªÙˆØ«ÙŠÙ‚ Ù…Ø³ØªØ®Ø¯Ù…Ø› Ø¥Ù† Ø£Ø¶ÙØª Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø§Ø³ØªØ®Ø¯Ù… JWT/OAuth2.
 * ========================================================= */

const ok = document.getElementById('ok');
const err = document.getElementById('err');

// ØªÙ†Ø¸ÙŠÙ Ø¹Ø§Ù… Ù„Ù†ØµÙˆØµ Ù‚Ø¯ ØªÙØ¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù€ DOM
function sanitize(text){ return String(text).replace(/[<>"]/g, ""); }

// Ø­Ù‚Ù† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ (Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ±)
async function inject(path, targetId){
  const target = document.getElementById(targetId);
  try{
    const res = await fetch(path, {credentials:'same-origin'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const html = await res.text();
    target.innerHTML = html;
    ok.textContent = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${path}`;
    ok.style.display = 'block';
    setTimeout(()=> ok.style.display='none', 1200);
  }catch(e){
    console.error(e);
    err.textContent = `ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ${path}. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø£Ùˆ Ø´ØºÙ‘Ù„ Ù…Ù† Ø®Ø§Ø¯Ù… Ù…Ø­Ù„ÙŠ.`;
    err.style.display = 'block';
  }
}

// Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ´ØºÙŠÙ„ Ù…Ù† Ù…Ù„Ù: Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ fetch Ù„Ù…Ù„ÙØ§Øª Ù…Ø­Ù„ÙŠØ©.
// Ø§Ù„Ø£ÙØ¶Ù„ ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… Ù…Ø­Ù„ÙŠ Ø¨Ø³ÙŠØ·: Ù…Ø«Ø§Ù„ ÙÙŠ Ø¨Ø§ÙŠØ«ÙˆÙ†:  python -m http.server 8000
inject('./header.html','header-placeholder');
inject('./footer.html','footer-placeholder');

// Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© (ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ù† API Ø¢Ù…Ù† Ø¹Ø¨Ø± HTTPS)
const cars = [
  {
    id:'c1',
    brand:'ØªÙˆÙŠÙˆØªØ§',
    model:'ÙƒØ§Ù…Ø±ÙŠ 2022',
    price: 105000,
    fuel:'Ø¨Ù†Ø²ÙŠÙ†',
    img:'https://images.unsplash.com/photo-1549924231-f129b911e442?q=80&w=1600&auto=format&fit=crop',
    specs:{
      general:['Ø³Ø¹Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ 2.5L','Ù†Ø§Ù‚Ù„ Ø­Ø±ÙƒØ© Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ 8 Ø§Ù„Ø³Ø±Ø¹Ø§Øª','Ù†Ø¸Ø§Ù… Ø£Ù…Ø§Ù† Toyota Safety Sense'],
      exterior:['Ø¬Ù†ÙˆØ· 18"','Ù…ØµØ§Ø¨ÙŠØ­ LED','Ø­Ø³Ø§Ø³Ø§Øª Ø£Ù…Ø§Ù…ÙŠØ© ÙˆØ®Ù„ÙÙŠØ©'],
      interior:['Ù…Ù‚Ø§Ø¹Ø¯ Ù‚Ù…Ø§Ø´ ÙØ§Ø®Ø±','Ø´Ø§Ø´Ø© 9" Apple CarPlay','Ù…ÙƒÙŠÙ Ù…Ø²Ø¯ÙˆØ¬ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚']
    }
  },
  {
    id:'c2',
    brand:'Ù…Ø±Ø³ÙŠØ¯Ø³',
    model:'C200 2021',
    price: 175000,
    fuel:'Ø¨Ù†Ø²ÙŠÙ†',
    img:'https://images.unsplash.com/photo-1553440569-bcc63803a83d?q=80&w=1600&auto=format&fit=crop',
    specs:{
      general:['Ù…Ø­Ø±Ùƒ ØªÙŠØ±Ø¨Ùˆ 1.5L','Ù†Ø§Ù‚Ù„ 9G-TRONIC','Ù†Ø¸Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚'],
      exterior:['ÙØªØ­Ø© Ø³Ù‚Ù Ø¨Ø§Ù†ÙˆØ±Ø§Ù…Ø§','Ø¥Ø¶Ø§Ø¡Ø© Ù…Ø­ÙŠØ·ÙŠØ©','Ø¬Ù†ÙˆØ· AMG'],
      interior:['Ø¬Ù„Ø¯ ØµÙ†Ø§Ø¹ÙŠ Artico','Ø´Ø§Ø´Ø© 10.25"','Ù†Ø¸Ø§Ù… ØµÙˆØªÙŠ 9 Ø³Ù…Ø§Ø¹Ø§Øª']
    }
  },
  {
    id:'c3',
    brand:'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ',
    model:'Ø³ÙˆÙ†Ø§ØªØ§ 2023 Ù‡Ø§ÙŠØ¨Ø±Ø¯',
    price: 129000,
    fuel:'Ù‡Ø§ÙŠØ¨Ø±Ø¯',
    img:'https://images.unsplash.com/photo-1592853625601-cb3ef3eac6a8?q=80&w=1600&auto=format&fit=crop',
    specs:{
      general:['Ù…Ø­Ø±Ùƒ 2.0L Ù‡Ø§ÙŠØ¨Ø±Ø¯','Ø§Ù‚ØªØµØ§Ø¯ ÙˆÙ‚ÙˆØ¯ Ù…Ù…ØªØ§Ø²','ÙˆØ³Ø§Ø¦Ø¯ Ù‡ÙˆØ§Ø¦ÙŠØ© 6'],
      exterior:['Ø´Ø¨Ùƒ Ø£Ù…Ø§Ù…ÙŠ ÙƒØ±ÙˆÙ…','ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠØ©','Ù…ØµØ§Ø¨ÙŠØ­ Ù†Ù‡Ø§Ø±ÙŠØ©'],
      interior:['Ù…Ù‚Ø§Ø¹Ø¯ Ù…Ø®Ù…Ù„','Ø´Ø§Ø­Ù† Ù„Ø§Ø³Ù„ÙƒÙŠ','Ù…Ø«Ø¨Øª Ø³Ø±Ø¹Ø©']
    }
  }
];

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
const listEl = document.getElementById('cars');

function cardTemplate(car){
  return `
  <article class="card" data-id="${car.id}" data-brand="${sanitize(car.brand)}" data-fuel="${sanitize(car.fuel)}" data-price="${car.price}">
    <img src="${sanitize(car.img)}" alt="ØµÙˆØ±Ø© ${sanitize(car.brand)} ${sanitize(car.model)}" class="thumb" loading="lazy">
    <div class="body">
      <div class="title">
        <h3>${sanitize(car.brand)} ${sanitize(car.model)}</h3>
        <div class="price">${car.price.toLocaleString('ar-SA')} Ø±.Ø³</div>
      </div>
      <div class="chips">
        <span class="chip">${sanitize(car.fuel)}</span>
        <span class="chip">Ø¹Ø§Ù…: ${sanitize(car.specs.general[0])}</span>
      </div>
      <div class="actions">
        <button class="btn" data-action="details" data-target="${car.id}">ØªÙØ§ØµÙŠÙ„</button>
        <button class="btn primary" data-action="contact" data-target="${car.id}">ØªÙˆØ§ØµÙ„</button>
      </div>
    </div>
  </article>`;
}

function renderCars(items){
  listEl.innerHTML = items.map(cardTemplate).join('');
}
renderCars(cars);

// ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ù…ÙˆØ¯Ø§Ù„
const dlg = document.getElementById('detailsDialog');
const modalTitle = document.getElementById('modalTitle');
const modalImg = document.getElementById('modalImg');
const genSpecs = document.getElementById('genSpecs');
const extSpecs = document.getElementById('extSpecs');
const intSpecs = document.getElementById('intSpecs');
document.getElementById('closeModal').addEventListener('click', ()=> dlg.close());

function openDetails(id){
  const car = cars.find(c=>c.id===id);
  if(!car){ return; }
  modalTitle.textContent = `${car.brand} ${car.model}`;
  modalImg.src = car.img;
  modalImg.alt = `ØµÙˆØ±Ø© ${car.brand} ${car.model}`;

  function ul(list, el){
    el.innerHTML = list.map(li=> `<li>${sanitize(li)}</li>`).join('');
  }
  ul(car.specs.general, genSpecs);
  ul(car.specs.exterior, extSpecs);
  ul(car.specs.interior, intSpecs);

  dlg.showModal();
}

// Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
listEl.addEventListener('click', (e)=>{
  const btn = e.target.closest('button[data-action]');
  if(!btn) return;
  const id = btn.getAttribute('data-target');

  if(btn.dataset.action==='details'){
    openDetails(id);
  }else if(btn.dataset.action==='contact'){
    // Ø±Ø³Ø§Ù„Ø© ÙˆØ¯Ù‘ÙŠØ©Ø› Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø§Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± HTTPS
    alert('Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø±Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ§ØµÙ„ Ø¢Ù…Ù† Ù„Ø§Ø­Ù‚Ù‹Ø§. ğŸ‘‹');
  }
});

// ÙÙ„ØªØ±Ø© ÙˆØ¨Ø­Ø« (Ù…Ù† Ø´Ø±ÙŠØ· Ø§Ù„ØµÙØ­Ø© + Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¹Ø¨Ø± Ø­Ø¯Ø« Ù…Ø®ØµØµ)
const brandSel = document.getElementById('brand');
const fuelSel  = document.getElementById('fuel');
const minP = document.getElementById('minPrice');
const maxP = document.getElementById('maxPrice');

function filterCars(queryText=''){
  const q = (queryText || '').trim();
  const brand = brandSel.value;
  const fuel  = fuelSel.value;
  const min = parseInt(minP.value || '0',10);
  const max = parseInt(maxP.value || '0',10);

  // ÙÙ„ØªØ±Ø© Ø¢Ù…Ù†Ø©
  const filtered = cars.filter(c=>{
    if(brand && c.brand!==brand) return false;
    if(fuel && c.fuel!==fuel) return false;
    if(min && c.price < min) return false;
    if(max && c.price > max) return false;
    if(q){
      const hay = `${c.brand} ${c.model} ${c.fuel}`.toLowerCase();
      const needle = q.toLowerCase().replace(/[<>"]/g,'');
      if(!hay.includes(needle)) return false;
    }
    return true;
  });
  renderCars(filtered);
}

[brandSel, fuelSel, minP, maxP].forEach(el => el.addEventListener('input', ()=> filterCars()));

window.addEventListener('kh-search', (ev)=> {
  filterCars(ev.detail?.query || '');
});

// ØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ· Ù„Ù„Ø£Ø¯Ø§Ø¡: Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù€ dialog Ø¹Ù†Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„
window.addEventListener('hashchange', ()=>{
  if(location.hash==='#cars'){ listEl.scrollIntoView({behavior:'smooth', block:'start'}); }
});
</script>
</body>
</html>
